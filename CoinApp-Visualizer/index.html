<head><link rel="stylesheet" href="css/mystyle.css">
</head>
<body>
<main></main>
    <select name="moedaBase" id="moedaBase"></select>
    <input type="text" id="moedaFrom" name="moedaFrom"> 
    <select name="moedaAConverter"  id="moedaAConverter"></select>
    <input type="text" id="moedaTo" name="moedaTo"><br><br>

</body>

<script>
    async function getContentAPI(){
        try{
            const responseAPIListarMoedas = await fetch('http://localhost:8765/COIN-APP/listarMoedas')
            const dataAPIListarMoedas = await responseAPIListarMoedas.json()

            const responseAPIMoedasDisponiveis = await fetch('http://localhost:8765/COIN-APP/moedasDisponiveis')
            const dataAPIMoedasDisponiveis = await responseAPIMoedasDisponiveis.json()            

            listarMoedasParaReal(dataAPIListarMoedas)
            preencherDropdown(dataAPIMoedasDisponiveis)

            var selectMoedaBase = document.getElementById("moedaBase");
            var selectMoedaAConverter = document.getElementById("moedaAConverter");
            var from = selectMoedaBase.options[selectMoedaBase.index].text;
            var to = selectMoedaAConverter.options[selectMoedaAConverter.index].text;
            var qtdMoeda = document.getElementById("moedaFrom").value;

            converterMoeda(from,to,qtd)
        }catch( error ){
            console.log( "GetContentAPI | ", error );
        }
    }

    getContentAPI()

    function preencherDropdown(dados){
        var selectMoedaBase = document.getElementById("moedaBase");
        var selectMoedaAConverter = document.getElementById("moedaAConverter");

        for( const dado of Object.keys(dados) ){
            selectMoedaBase.options[selectMoedaBase.options.length] = new Option(dados[dado],dado);
            selectMoedaAConverter.options[selectMoedaAConverter.options.length] = new Option(dados[dado],dado);
        }

    }
    function listarMoedasParaReal(dados){
        let output = ''
        
        for( let dado of dados){
            output +=` ${dado.name} -----> Valor: ${dado.bid}<br>`;            
        }

        output+=`<br>`

        document.querySelector('main').innerHTML = output
    }

    async function converterMoeda(from,to,qtd){
        
        const responseAPIConverter = await fetch('http://localhost:8765/COIN-APP/converter/'+from+'/'+to+'/'+qtd)
        const dataAPIConverter = await responseAPIConverter.json()  

        var totalConvertido = `${dataAPIConverter.total}`

        var moedaConvertida = document.getElementById("moedaTo");
        moedaConvertida.value = totalConvertido;

    }
</script>