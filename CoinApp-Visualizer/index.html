<head><link rel="stylesheet" href="/css/mystyle.css">
</head>
<body>
<main></main>
<select name="moedaBase" id="moedaBase"></select>
<input type="text" id="moedaFrom" name="moedaFrom"> 
<select name="moedaAConverter" id="moedaAConverter"></select>
<input type="text" id="moedaTo" name="moedaTo"><br><br>
</body>

<script>
    async function getContentAPI(){
        try{
            const responseAPI = await fetch('http://localhost:8765/COIN-APP/listarMoedas')
            const dataAPI = await responseAPI.json()

            const responseAPI2 = await fetch('http://localhost:8765/COIN-APP/moedasDisponiveis')
            const dataAPI2 = await responseAPI2.json()
            

            listarMoedasParaReal(dataAPI)
            preencherDropdown(dataAPI2)
        }catch( error ){
            console.log( "GetContentAPI | ", error );
        }
    }

    getContentAPI()

    function preencherDropdown(dados){
        var selectMoedaBase = document.getElementById("moedaBase");
        var selectMoedaAConverter = document.getElementById("moedaAConverter");

        for( let dado of dados ){
            selectMoedaBase.options[selectMoedaBase.options.length] = new Option(dado, dado);
            selectMoedaAConverter.options[selectMoedaAConverter.options.length] = new Option(dado, dado);
        }

    }
    function listarMoedasParaReal(dados){
        let output = ''
        for( let dado of dados){
             output +=` ${dado.name} -----> Valor: ${dado.bid}<br>`;
            var moedaTo = document.getElementById("moedaTo");
            var moedaFrom = document.getElementById("moedaFrom");
            var moedaToLabel = document.getElementById("moedaToLabel");
            var moedaFromLabel = document.getElementById("moedaFromLabel");
            if(`${dado.code}` == "USD"){
                moedaFrom.value = (`1.00`).toLocaleString('pt-br',{minimumFractionDigits: 2});

                moedaTo.value =moedaFrom.value * `${dado.bid}`;


                moedaFrom.addEventListener('input', function (evt) {
                    moedaFrom.value.toLocaleString('pt-br',{minimumFractionDigits: 2});

                    moedaTo.value =(moedaFrom.value * `${dado.bid}`).toLocaleString('pt-br',{minimumFractionDigits: 2});

                                });
            } 
        }

        document.querySelector('main').innerHTML = output

    }

</script>